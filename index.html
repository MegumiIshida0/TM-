<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teachable Machine Image Model - p5.js and ml5.js</title>
</head>
<body>
  <div>Teachable Machine Image Model - p5.js and ml5.js</div>

  <script src="https://cdn.jsdelivr.net/npm/p5@latest/lib/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@latest/lib/addons/p5.dom.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ml5@latest/dist/ml5.min.js"></script>

  <script type="text/javascript">
    // Classifier Variable
    let classifier;
    // Model URL
    let imageModelURL = 'https://teachablemachine.withgoogle.com/models/O2CXrhSLy/';
    
    // Video
    let video;
    let flippedVideo;
    // To store the classification
    let label = "Loading model...";

    // Load the model first
    function preload() {
      classifier = ml5.imageClassifier(imageModelURL + 'model.json', modelLoaded);
    }

    // When the model is loaded
    function modelLoaded() {
      console.log("Model Loaded!");
      label = "Model Loaded!";
    }

    function setup() {
      createCanvas(320, 260);
      // Create the video
      video = createCapture(VIDEO);
      video.size(320, 240);
      video.hide();
      // Start classifying once the video is ready
      classifyVideo();
    }

    function draw() {
      background(0);
      // Draw the video
      flippedVideo = ml5.flipImage(video); // Flip the video for correct orientation
      image(flippedVideo, 0, 0);

      // Draw the label
      fill(255);
      textSize(16);
      textAlign(CENTER);
      text(label, width / 2, height - 4);
    }

    // Get a prediction for the current video frame
    function classifyVideo() {
      classifier.classify(flippedVideo, gotResult); // Use the flipped video
    }

    // When we get a result
    function gotResult(error, results) {
      // If there is an error
      if (error) {
        console.error("Classification Error: ", error);
        label = "Error during classification";
        return;
      }
      // The results are in an array ordered by confidence.
      label = results[0].label;
      // Classify again for the next frame!
      classifyVideo();
    }
  </script>
</body>
</html>
